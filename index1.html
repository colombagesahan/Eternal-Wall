<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETERNAL WALL | The Legacy</title>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg: #050505;
            --surface: #0f0f0f;
            --border: #222;
            --gold: #C5A059;
            --text-main: #f0f0f0;
            --text-muted: #666;
            --error: #8b2b2b;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Lato', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            letter-spacing: 0.5px;
        }

        h1, h2, h3, .serif { font-family: 'Playfair Display', serif; font-weight: 400; }
        a { text-decoration: none; color: inherit; transition: 0.3s; }
        a:hover { color: var(--gold); }
        button { cursor: pointer; transition: 0.3s; font-family: inherit; }

        /* --- BACKGROUND FX --- */
        #starfield {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: var(--bg);
            opacity: 0.5;
        }
        .star {
            position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%;
            opacity: 0; animation: twinkle 4s infinite ease-in-out;
        }
        @keyframes twinkle { 0% { opacity: 0; } 50% { opacity: 0.7; } 100% { opacity: 0; } }

        /* --- UI KIT --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        .btn {
            padding: 12px 30px; border: 1px solid var(--border); background: transparent;
            color: var(--text-main); font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase;
            transition: all 0.4s ease;
        }
        .btn:hover { border-color: var(--gold); color: var(--gold); }
        .btn-solid { background: var(--gold); color: black; border-color: var(--gold); font-weight: bold; }
        .btn-solid:hover { background: #b08d4b; color: black; }

        .input-minimal {
            width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--border);
            color: white; padding: 15px 0; font-family: 'Playfair Display'; font-size: 1.1rem;
            margin-bottom: 20px; transition: 0.3s;
        }
        .input-minimal:focus { border-bottom-color: var(--gold); }
        .input-minimal::placeholder { color: #333; font-family: 'Lato'; font-size: 0.9rem; }

        /* --- NAV --- */
        nav {
            padding: 30px 40px; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; background: rgba(5,5,5,0.9); z-index: 100;
            border-bottom: 1px solid var(--border);
        }
        .brand { font-family: 'Playfair Display'; font-size: 1.5rem; letter-spacing: 3px; }
        .nav-link { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); }
        .nav-link:hover { color: white; }

        /* --- VIEWS --- */
        .view { display: none; padding-top: 40px; padding-bottom: 100px; opacity: 0; transition: opacity 0.8s; }
        .active-view { display: block; opacity: 1; }

        /* --- HOME --- */
        .hero { text-align: center; margin: 60px 0 80px; }
        .hero h1 { font-size: 4rem; margin: 0; line-height: 1.1; }
        .hero p { color: var(--text-muted); margin-top: 15px; font-weight: 300; letter-spacing: 1px; }

        .wall-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1px; border: 1px solid var(--border); background: var(--border);
        }
        .tile {
            aspect-ratio: 1; background: #0a0a0a; position: relative; overflow: hidden; cursor: pointer;
        }
        .tile img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); transition: 0.6s; opacity: 0.6; }
        .tile:hover img { filter: grayscale(0%); opacity: 1; transform: scale(1.05); }
        .tile-info {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px;
            background: linear-gradient(to top, black, transparent); opacity: 0; transition: 0.4s;
        }
        .tile:hover .tile-info { opacity: 1; }

        /* --- DASHBOARD --- */
        .dash-header { 
            text-align: center; border-bottom: 1px solid var(--border); padding-bottom: 40px; margin-bottom: 40px; 
        }
        .clock-display { font-family: 'Playfair Display'; font-size: 3rem; color: var(--gold); margin: 10px 0; }
        .meta-row { display: flex; justify-content: center; gap: 30px; color: var(--text-muted); font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; }

        .dash-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; }

        .panel { margin-bottom: 40px; }
        .panel-title { font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        /* WIDGETS */
        .mood-slider { width: 100%; height: 1px; background: #333; position: relative; cursor: pointer; margin: 30px 0; }
        .mood-knob { width: 10px; height: 10px; background: var(--gold); border-radius: 50%; position: absolute; top: -5px; transition: left 0.3s; }
        
        .pulse-box { border: 1px solid var(--border); padding: 30px; text-align: center; }
        .pulse-q { font-size: 1.5rem; margin-bottom: 20px; font-family: 'Playfair Display'; }
        .blur-txt { color: transparent; text-shadow: 0 0 12px rgba(255,255,255,0.5); cursor: pointer; transition: 0.5s; }
        .blur-txt:hover { text-shadow: 0 0 0 white; color: white; }

        .prop-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .prop-status { font-size: 0.7rem; color: var(--gold); letter-spacing: 1px; text-transform: uppercase; }

        /* CHAT DRAWER */
        .chat-drawer {
            position: fixed; bottom: 0; right: 40px; width: 320px; background: #0a0a0a;
            border: 1px solid var(--border); border-bottom: none; transform: translateY(100%); transition: 0.4s; z-index: 200;
        }
        .chat-drawer.open { transform: translateY(0); }
        .chat-bar { padding: 15px; border-bottom: 1px solid var(--border); cursor: pointer; display: flex; justify-content: space-between; }
        .chat-content { height: 400px; display: flex; flex-direction: column; }
        .msgs { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg { font-size: 0.9rem; color: #aaa; max-width: 80%; line-height: 1.5; }
        .msg-me { align-self: flex-end; text-align: right; color: white; }
        .chat-input { padding: 15px; border-top: 1px solid var(--border); background: #000; border: none; color: white; width: 100%; font-family: 'Lato'; }

        /* PROFILE */
        .prof-hero { text-align: center; padding-bottom: 60px; border-bottom: 1px solid var(--border); }
        .prof-img { width: 120px; height: 120px; object-fit: cover; margin-bottom: 20px; filter: grayscale(100%); }
        .prof-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px; margin-top: 60px; }
        .memory-block img { width: 100%; margin-bottom: 15px; filter: grayscale(20%); }
        .memory-date { font-size: 0.7rem; color: var(--gold); letter-spacing: 2px; }
        .memory-cap { font-family: 'Playfair Display'; font-size: 1.2rem; margin-top: 5px; }

        /* AUTH */
        .auth-box { max-width: 400px; margin: 10vh auto; text-align: center; }

        @media(max-width: 768px) { .dash-grid { grid-template-columns: 1fr; } .hero h1 { font-size: 2.5rem; } }

    </style>
</head>
<body>

    <div id="starfield"></div>

    <nav>
        <div class="brand">ETERNAL</div>
        <div id="nav-actions"></div>
    </nav>

    <!-- 1. HOME VIEW -->
    <div id="view-home" class="view active-view">
        <div class="container">
            <div class="hero">
                <h1>The Monument</h1>
                <p>A permanent record of human connection.</p>
                <input type="text" style="background:transparent; border:none; border-bottom:1px solid #333; color:white; text-align:center; margin-top:30px; padding:10px; width:200px;" placeholder="Search ID..." onkeyup="searchFilter()">
            </div>
            <div class="wall-grid" id="wall-grid"></div>
        </div>
    </div>

    <!-- 2. DASHBOARD VIEW -->
    <div id="view-dashboard" class="view">
        <div class="container">
            
            <!-- SINGLE USER -->
            <div id="dash-single" style="text-align:center; padding: 60px 0; display:none;">
                <h2 class="serif" style="font-size:2rem; margin-bottom:20px;">The Union</h2>
                <p style="color:var(--text-muted); margin-bottom:40px;">Eternal Wall is built for two. Invite your partner to begin.</p>
                <div style="border:1px solid var(--border); padding:15px; display:inline-block; font-family:monospace; margin-bottom:20px; color:var(--gold);" id="blink-code">...</div>
                <br>
                <button class="btn" onclick="copyBlink()">COPY INVITATION</button>
            </div>

            <!-- COUPLE USER -->
            <div id="dash-couple" style="display:none;">
                <div class="dash-header">
                    <div class="meta-row">
                        <span>EST. 2025</span>
                        <span><span id="streak-val">0</span> DAYS RECORDED</span>
                    </div>
                    <div class="clock-display" id="clock">00 : 00 : 00</div>
                    <div style="font-size:0.7rem; letter-spacing:4px; color:var(--text-muted);">YEARS DAYS HOURS</div>
                </div>

                <div class="dash-grid">
                    <!-- LEFT -->
                    <div>
                        <div class="panel">
                            <div class="panel-title">Resonance</div>
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:var(--text-muted); margin-bottom:10px;">
                                <span>SOLITUDE</span>
                                <span>CONNECTION</span>
                            </div>
                            <div class="mood-slider" id="mood-track" onclick="setMood(event)">
                                <div class="mood-knob" id="mood-knob"></div>
                            </div>
                            <div style="text-align:right; font-size:0.8rem; color:var(--gold);" id="mood-label">Partner: ...</div>
                        </div>

                        <div class="panel pulse-box">
                            <div style="font-size:0.7rem; color:var(--gold); letter-spacing:2px; margin-bottom:20px;">QUESTION OF THE DAY</div>
                            <div class="pulse-q" id="pulse-q">...</div>
                            <div id="pulse-in">
                                <input class="input-minimal" id="pulse-ans" placeholder="Type your answer...">
                                <button class="btn" onclick="subPulse()">REVEAL</button>
                            </div>
                            <div id="pulse-out" style="display:none; text-align:left;">
                                <p style="font-size:0.8rem; color:var(--text-muted);">YOU</p>
                                <p id="ans-me" style="margin-bottom:20px;">...</p>
                                <p style="font-size:0.8rem; color:var(--text-muted);">PARTNER</p>
                                <p id="ans-part" class="blur-txt">Waiting for answer...</p>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-title">Time Capsule</div>
                            <input class="input-minimal" id="cap-msg" placeholder="Message for the future">
                            <input type="date" id="cap-date" style="background:#111; border:1px solid #333; color:white; padding:5px;">
                            <button class="btn" onclick="addCap()" style="margin-top:10px;">LOCK</button>
                            <div id="cap-list" style="margin-top:20px; font-size:0.8rem; color:var(--text-muted);"></div>
                        </div>
                    </div>

                    <!-- RIGHT -->
                    <div>
                        <div class="panel">
                            <div class="panel-title">Wall Proposals</div>
                            <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:20px;">
                                Drafts require mutual consent before engraving.
                            </p>
                            <input class="input-minimal" id="prop-img" placeholder="Image URL">
                            <input class="input-minimal" id="prop-txt" placeholder="Caption">
                            <button class="btn btn-solid" style="width:100%" onclick="addProp()">PROPOSE ENGRAVING</button>
                            
                            <div id="prop-list" style="margin-top:40px;"></div>
                        </div>
                    </div>
                </div>

                <!-- CHAT -->
                <div class="chat-drawer" id="chat-win">
                    <div class="chat-bar" onclick="toggleChat()">
                        <span style="font-size:0.8rem; letter-spacing:1px;">PRIVATE LINE</span>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="chat-content">
                        <div class="msgs" id="chat-feed"></div>
                        <input class="chat-input" id="chat-in" placeholder="Write..." onkeypress="if(event.key==='Enter') sendChat()">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. PROFILE VIEW -->
    <div id="view-profile" class="view">
        <div class="container">
            <div class="prof-hero">
                <img src="" id="p-img" class="prof-img">
                <h1 class="serif" id="p-names">...</h1>
                <div style="font-size:0.8rem; letter-spacing:3px; color:var(--gold); margin-top:10px;" id="p-code">...</div>
            </div>
            <div class="prof-grid" id="p-grid"></div>
        </div>
    </div>

    <!-- 4. AUTH VIEW -->
    <div id="view-auth" class="view">
        <div class="auth-box">
            <h1 class="serif" style="margin-bottom:40px;">Entrance</h1>
            
            <div id="blink-alert" style="color:var(--gold); font-size:0.8rem; margin-bottom:20px; letter-spacing:1px; display:none;">
                LINKING PARTNER ACCOUNT
            </div>

            <input id="u-name" class="input-minimal" placeholder="Name" style="display:none;">
            <input id="u-email" class="input-minimal" placeholder="Email">
            <input id="u-pass" type="password" class="input-minimal" placeholder="Password">
            
            <button class="btn btn-solid" style="width:100%; margin-top:20px;" onclick="handleAuth()" id="btn-auth">ENTER</button>
            <div style="margin-top:30px; font-size:0.7rem; cursor:pointer; color:var(--text-muted); letter-spacing:1px;" onclick="toggleAuth()" id="txt-switch">REQUEST ACCESS</div>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBUjzMFao9BS3uXBOW3qYrLVqHaGn8qIk4",
            authDomain: "onlineshop-30cd1.firebaseapp.com",
            databaseURL: "https://onlineshop-30cd1-default-rtdb.firebaseio.com",
            projectId: "onlineshop-30cd1",
            storageBucket: "onlineshop-30cd1.firebasestorage.app",
            messagingSenderId: "818252574868",
            appId: "1:818252574868:web:8dd36825db589a886cc481",
            measurementId: "G-6YLGGH2NDD"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let user = null, cid = null, signup = false;

        // FX
        function initStars() {
            const c = document.getElementById('starfield');
            for(let i=0; i<50; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                s.style.top = Math.random()*100+'%';
                s.style.left = Math.random()*100+'%';
                s.style.animationDelay = Math.random()*4+'s';
                c.appendChild(s);
            }
        }
        initStars();

        // ROUTER
        function route(p) {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active-view'));
            const url = new URLSearchParams(location.search);
            if(!p && url.get('blink')) p = 'auth';
            if(!p && url.get('page') === 'profile') { p = 'profile'; loadProf(url.get('id')); }
            if(!p) p = 'home';
            document.getElementById(`view-${p}`).classList.add('active-view');
            navUpdate();
            if(p === 'auth' && url.get('blink')) blinkUI();
        }

        function navUpdate() {
            const el = document.getElementById('nav-actions');
            if(user) el.innerHTML = `<button class="btn" onclick="route('dashboard')">RESIDENCE</button>`;
            else el.innerHTML = `<button class="btn" onclick="route('auth')">ENTER</button>`;
        }

        // AUTH
        function toggleAuth() {
            signup = !signup;
            document.getElementById('u-name').style.display = signup ? 'block' : 'none';
            document.getElementById('btn-auth').innerText = signup ? "INITIALIZE" : "ENTER";
            document.getElementById('txt-switch').innerText = signup ? "EXISTING MEMBER" : "REQUEST ACCESS";
        }
        function blinkUI() {
            signup = true; toggleAuth(); signup = true;
            document.getElementById('blink-alert').style.display = 'block';
            document.getElementById('txt-switch').style.display = 'none';
        }
        async function handleAuth() {
            const e = document.getElementById('u-email').value;
            const p = document.getElementById('u-pass').value;
            const n = document.getElementById('u-name').value;
            const b = new URLSearchParams(location.search).get('blink');
            try {
                if(signup) {
                    const c = await auth.createUserWithEmailAndPassword(e, p);
                    const uid = c.user.uid;
                    let nc = null;
                    if(b) {
                        const inv = (await db.ref(`users/${b}`).once('value')).val();
                        if(inv && !inv.coupleId) {
                            nc = `c_${Date.now()}`;
                            await db.ref(`couples/${nc}`).set({ u1:b, u2:uid, start:Date.now() });
                            await db.ref(`users/${b}`).update({ coupleId: nc });
                        }
                    }
                    await db.ref(`users/${uid}`).set({ name:n, email:e, coupleId: nc });
                    history.replaceState({},'',location.pathname);
                } else {
                    await auth.signInWithEmailAndPassword(e, p);
                }
                route('dashboard');
            } catch(err) { alert(err.message); }
        }

        // DASHBOARD
        auth.onAuthStateChanged(u => {
            user = u;
            if(u) {
                db.ref(`users/${u.uid}`).on('value', s => {
                    const d = s.val();
                    if(d.coupleId) { cid = d.coupleId; initCouple(); }
                    else initSingle();
                });
            }
            navUpdate();
        });

        function initSingle() {
            document.getElementById('dash-single').style.display = 'block';
            document.getElementById('dash-couple').style.display = 'none';
            document.getElementById('blink-code').innerText = `${location.origin}${location.pathname}?blink=${user.uid}`;
        }
        function copyBlink() {
            navigator.clipboard.writeText(document.getElementById('blink-code').innerText);
            alert("Invitation Copied");
        }

        function initCouple() {
            document.getElementById('dash-single').style.display = 'none';
            document.getElementById('dash-couple').style.display = 'block';
            
            // Clock
            db.ref(`couples/${cid}/start`).on('value', s => {
                const start = s.val() || Date.now();
                setInterval(() => {
                    const diff = Date.now() - start;
                    const d = Math.floor(diff/86400000);
                    document.getElementById('clock').innerText = 
                        `${Math.floor(d/365)} : ${d%365} : ${Math.floor((diff/3600000)%24)}`;
                    document.getElementById('streak-val').innerText = d;
                }, 1000);
            });

            // Mood
            db.ref(`couples/${cid}/mood`).on('value', s => {
                const d = s.val();
                if(d) {
                    const pid = Object.keys(d).find(k => k !== user.uid);
                    if(pid) {
                        document.getElementById('mood-label').innerText = `PARTNER RESONANCE: ${d[pid]}%`;
                        document.getElementById('mood-knob').style.left = d[pid] + '%'; // Visualizes partner's mood
                    }
                }
            });

            // Pulse
            const qs = ["Best memory?", "Dream home?", "Favorite sound?", "Legacy goal?"];
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('pulse-q').innerText = qs[Math.floor(Date.now()/86400000)%qs.length];
            
            db.ref(`couples/${cid}/pulse/${today}`).on('value', s => {
                const d = s.val();
                if(d && d[user.uid]) {
                    document.getElementById('pulse-in').style.display = 'none';
                    document.getElementById('pulse-out').style.display = 'block';
                    document.getElementById('ans-me').innerText = d[user.uid];
                    const pid = Object.keys(d).find(k => k !== user.uid);
                    const pAns = document.getElementById('ans-part');
                    if(pid) {
                        pAns.innerText = d[pid];
                        pAns.onclick = () => pAns.classList.remove('blur-txt');
                    }
                }
            });

            // Proposals
            db.ref(`couples/${cid}/props`).on('value', s => {
                const l = document.getElementById('prop-list');
                l.innerHTML = "";
                const d = s.val();
                if(d) {
                    Object.keys(d).forEach(k => {
                        const p = d[k];
                        const div = document.createElement('div');
                        div.className = 'prop-item';
                        let act = "";
                        if(p.status === 'pending') {
                            if(p.by === user.uid) act = `<button class="btn" style="padding:5px 10px; font-size:0.6rem;" onclick="delProp('${k}')">WITHDRAW</button>`;
                            else act = `<button class="btn btn-solid" style="padding:5px 10px; font-size:0.6rem;" onclick="sealProp('${k}')">ENGRAVE</button>`;
                        } else {
                            act = `<span class="prop-status">ENGRAVED</span>`;
                        }
                        div.innerHTML = `<div>${p.txt}</div>${act}`;
                        l.prepend(div);
                    });
                }
            });

            // Chat
            db.ref(`couples/${cid}/chat`).limitToLast(20).on('child_added', s => {
                const m = s.val();
                const d = document.createElement('div');
                d.className = `msg ${m.u === user.uid ? 'msg-me' : ''}`;
                d.innerText = m.t;
                const f = document.getElementById('chat-feed');
                f.appendChild(d);
                f.scrollTop = f.scrollHeight;
            });

            // Capsule
             db.ref(`couples/${cid}/caps`).on('value', s => {
                const l = document.getElementById('cap-list');
                l.innerHTML = "";
                const d = s.val();
                if(d) Object.values(d).forEach(c => {
                    const lock = Date.now() < c.time;
                    l.innerHTML += `<div style="margin-bottom:5px; padding:5px; border-bottom:1px solid #222;">
                        <i class="fas ${lock ? 'fa-lock' : 'fa-envelope-open'}"></i> 
                        ${lock ? new Date(c.time).toLocaleDateString() : c.msg}
                    </div>`;
                });
            });
        }

        // ACTIONS
        function setMood(e) {
            const r = document.getElementById('mood-track').getBoundingClientRect();
            const v = Math.min(100, Math.max(0, ((e.clientX - r.left)/r.width)*100));
            db.ref(`couples/${cid}/mood/${user.uid}`).set(Math.floor(v));
        }
        function subPulse() {
            const v = document.getElementById('pulse-ans').value;
            if(v) db.ref(`couples/${cid}/pulse/${new Date().toISOString().split('T')[0]}/${user.uid}`).set(v);
        }
        function addProp() {
            const i = document.getElementById('prop-img').value;
            const t = document.getElementById('prop-txt').value;
            if(i && t) {
                db.ref(`couples/${cid}/props`).push({ by:user.uid, img:i, txt:t, status:'pending' });
                document.getElementById('prop-txt').value = "";
            }
        }
        function delProp(k) { db.ref(`couples/${cid}/props/${k}`).remove(); }
        async function sealProp(k) {
            await db.ref(`couples/${cid}/props/${k}`).update({ status:'sealed' });
            const p = (await db.ref(`couples/${cid}/props/${k}`).once('value')).val();
            const cd = (await db.ref(`couples/${cid}`).once('value')).val();
            const n1 = (await db.ref(`users/${cd.u1}`).once('value')).val().name;
            const n2 = (await db.ref(`users/${cd.u2}`).once('value')).val().name;
            await db.ref('wall').push({ cid:cid, names:`${n1} & ${n2}`, img:p.img, txt:p.txt });
        }
        function toggleChat() { document.getElementById('chat-win').classList.toggle('open'); }
        function sendChat() {
            const i = document.getElementById('chat-in');
            if(i.value) { db.ref(`couples/${cid}/chat`).push({ u:user.uid, t:i.value }); i.value = ""; }
        }
        function addCap() {
            const m = document.getElementById('cap-msg').value;
            const t = document.getElementById('cap-date').value;
            if(m && t) db.ref(`couples/${cid}/caps`).push({ msg:m, time: new Date(t).getTime() });
        }

        // WALL
        db.ref('wall').limitToLast(50).on('value', s => {
            const g = document.getElementById('wall-grid');
            g.innerHTML = "";
            const d = s.val();
            if(d) Object.values(d).reverse().forEach(p => {
                const t = document.createElement('div');
                t.className = 'tile';
                t.onclick = () => location.href = `?page=profile&id=${p.cid}`;
                t.innerHTML = `
                    <img src="${p.img}">
                    <div class="tile-info">
                        <div class="serif" style="color:var(--gold); font-size:1.1rem;">${p.names}</div>
                    </div>
                `;
                g.appendChild(t);
            });
        });

        // PROFILE
        async function loadProf(id) {
            const s = await db.ref('wall').orderByChild('cid').equalTo(id).once('value');
            const d = s.val();
            if(!d) return;
            const arr = Object.values(d).reverse();
            document.getElementById('p-names').innerText = arr[0].names;
            document.getElementById('p-code').innerText = `#${id.substring(5,10).toUpperCase()}`;
            document.getElementById('p-img').src = arr[0].img;
            
            const g = document.getElementById('p-grid');
            g.innerHTML = "";
            arr.forEach(p => {
                g.innerHTML += `
                    <div class="memory-block">
                        <img src="${p.img}">
                        <div class="memory-date">ENGRAVED FOREVER</div>
                        <div class="memory-cap">"${p.txt}"</div>
                    </div>
                `;
            });
        }

        route();
    </script>
</body>
</html>
