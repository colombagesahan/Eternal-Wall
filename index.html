<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EternalWall | The Network for Lovers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .heart-mask { clip-path: path("M12 4.248c-3.148-5.402-12-3.825-12 2.944 0 4.661 5.571 9.427 12 15.808 6.43-6.381 12-11.147 12-15.808 0-6.792-8.875-8.306-12-2.944z"); }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(5px); }
        #map { height: 600px; z-index: 1; border-radius: 1rem; }
    </style>
</head>
<body class="bg-rose-50 text-gray-800">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 glass shadow-sm transition-all duration-300">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-bold text-rose-600 tracking-tighter">EternalWall <i class="fas fa-heart"></i></a>
            <div class="hidden md:flex space-x-4">
                <input type="text" id="searchInput" placeholder="Enter Couple Code..." class="border rounded-full px-4 py-1 text-sm focus:outline-rose-500 w-64">
                <button onclick="searchCouple()" class="text-rose-600 hover:text-rose-800"><i class="fas fa-search"></i></button>
            </div>
            <div>
                <a href="dashboard.html" class="bg-rose-600 text-white px-6 py-2 rounded-full hover:bg-rose-700 transition shadow-lg">Login / Join</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-24 pb-10">
        
        <!-- Hero -->
        <header class="text-center py-16 px-4">
            <h1 class="text-5xl md:text-7xl font-bold text-gray-900 mb-6">Where Love Live Forever</h1>
            <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">The exclusive social network for two. Connect with your partner, build your legacy, and pin your love on the world map.</p>
        </header>

        <!-- World Map -->
        <section class="container mx-auto px-4 mb-20 relative">
            <div id="map" class="shadow-2xl border-4 border-white"></div>
            <div class="absolute top-4 right-8 bg-white p-2 rounded shadow z-[400] text-xs">
                <i class="fas fa-circle text-rose-500"></i> Active Couples
            </div>
        </section>

    </div>

    <!-- Profile Modal (Popup) -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-90 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-2xl overflow-hidden relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeProfile()" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 z-10"><i class="fas fa-times text-2xl"></i></button>
            
            <div class="text-center p-8 pb-0">
                <div class="relative w-32 h-32 mx-auto mb-4">
                    <img id="p_image" src="https://via.placeholder.com/150" class="w-full h-full object-cover heart-mask border-4 border-rose-500 shadow-lg bg-gray-100">
                </div>
                <h2 id="p_names" class="text-3xl font-bold text-gray-800 mb-1">Loading...</h2>
                <p id="p_city" class="text-sm text-gray-500 uppercase tracking-widest mb-2">City</p>
                <div id="p_badge" class="inline-block px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-bold uppercase mb-4">Status</div>
                <p id="p_slogan" class="text-lg italic font-serif text-rose-600 mb-6">"..."</p>
            </div>

            <div class="bg-gray-50 p-6 border-t">
                <h3 class="font-bold text-gray-700 mb-4">Latest Memories</h3>
                <div id="p_memories" class="space-y-4">
                    <!-- Posts injected via JS -->
                </div>
                <!-- Ad Space -->
                <div id="publicAdSpace" class="mt-8 hidden p-4 border border-dashed border-gray-300 rounded text-center">
                    <p class="text-xs text-gray-400">SPONSORED</p>
                    <div id="adContentPublic"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase & Logic -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBUjzMFao9BS3uXBOW3qYrLVqHaGn8qIk4",
            authDomain: "onlineshop-30cd1.firebaseapp.com",
            databaseURL: "https://onlineshop-30cd1-default-rtdb.firebaseio.com",
            projectId: "onlineshop-30cd1",
            storageBucket: "onlineshop-30cd1.firebasestorage.app",
            messagingSenderId: "818252574868",
            appId: "1:818252574868:web:8dd36825db589a886cc481",
            measurementId: "G-6YLGGH2NDD"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Map Setup
        var map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);

        // Load Public Profiles
        const dbRef = ref(db);
        get(child(dbRef, `public_profiles`)).then((snapshot) => {
            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    const coupleId = childSnapshot.key;
                    
                    if(data.lat && data.lng) {
                        const marker = L.marker([data.lat, data.lng]).addTo(map);
                        marker.bindPopup(`
                            <div class="text-center p-2">
                                <h3 class="font-bold text-rose-600">${data.names || 'Couple'}</h3>
                                <p class="text-xs text-gray-500">${data.city || 'Love City'}</p>
                                <button onclick="window.viewProfile('${coupleId}')" class="mt-2 text-xs bg-gray-800 text-white px-3 py-1 rounded">View Profile</button>
                            </div>
                        `);
                    }
                });
            }
        });

        // Search Function
        window.searchCouple = function() {
            const code = document.getElementById('searchInput').value.trim();
            if(!code) return;
            
            get(child(dbRef, `public_profiles`)).then((snapshot) => {
                let found = false;
                snapshot.forEach(child => {
                    if(child.val().code === code) {
                        found = true;
                        window.viewProfile(child.key);
                    }
                });
                if(!found) alert("Couple code not found.");
            });
        };

        // View Profile Logic
        window.viewProfile = function(cId) {
            get(child(dbRef, `public_profiles/${cId}`)).then(snap => {
                if(!snap.exists()) return;
                const d = snap.val();
                
                document.getElementById('profileModal').classList.remove('hidden');
                document.getElementById('p_names').innerText = d.names || "Unknown";
                document.getElementById('p_city').innerText = d.city || "Unknown City";
                document.getElementById('p_badge').innerText = d.badge || "Couple";
                document.getElementById('p_slogan').innerText = `"${d.slogan || 'Love is Eternal'}"`;
                
                // Load Ad if exists
                if(d.adContent) {
                    document.getElementById('publicAdSpace').classList.remove('hidden');
                    document.getElementById('adContentPublic').innerHTML = d.adContent;
                } else {
                    document.getElementById('publicAdSpace').classList.add('hidden');
                }

                // Load 3 recent memories (mock logic as memories are private in basic req, but lets show wall posts)
                const memDiv = document.getElementById('p_memories');
                memDiv.innerHTML = '<p class="text-center text-gray-400 text-sm">Join EternalWall to see full history.</p>';
            });
        };

        window.closeProfile = function() {
            document.getElementById('profileModal').classList.add('hidden');
        };
    </script>
</body>
</html>
