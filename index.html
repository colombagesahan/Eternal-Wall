<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EternalWall | The Network for Lovers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .heart-mask { clip-path: path("M12 4.248c-3.148-5.402-12-3.825-12 2.944 0 4.661 5.571 9.427 12 15.808 6.43-6.381 12-11.147 12-15.808 0-6.792-8.875-8.306-12-2.944z"); }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        #map { height: 600px; z-index: 1; }
        .gold-badge { background: linear-gradient(45deg, #FFD700, #FDB931); color: #5c4002; }
    </style>
</head>
<body class="bg-rose-50 text-gray-800">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 glass shadow-sm transition-all duration-300">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-bold text-rose-600 tracking-tighter">EternalWall <i class="fas fa-heart"></i></a>
            <div class="hidden md:flex space-x-6">
                <input type="text" id="searchInput" placeholder="Search Code (e.g. EW-123)" class="border rounded-full px-4 py-1 text-sm focus:outline-rose-500">
                <button onclick="searchCouple()" class="text-rose-600 hover:text-rose-800"><i class="fas fa-search"></i></button>
            </div>
            <div>
                <a href="dashboard.html" class="bg-rose-600 text-white px-6 py-2 rounded-full hover:bg-rose-700 transition shadow-lg hover:shadow-rose-500/50">Login / Join</a>
            </div>
        </div>
    </nav>

    <!-- Content Wrapper -->
    <div id="mainContent" class="pt-24">
        
        <!-- Hero -->
        <header class="text-center py-20 px-4 bg-gradient-to-b from-rose-50 to-white">
            <h1 class="text-5xl md:text-7xl font-bold text-gray-900 mb-6">Leave a Mark on Eternity</h1>
            <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">The exclusive social network for couples. Create your shared space, plan your future, and visualize your love on the world map.</p>
            <div class="flex justify-center gap-4">
                <a href="dashboard.html" class="bg-rose-600 text-white px-8 py-3 rounded-full text-lg shadow-lg hover:bg-rose-700">Create Couple Account</a>
            </div>
        </header>

        <!-- World Map -->
        <section class="container mx-auto px-4 mb-20">
            <h2 class="text-3xl font-bold text-center mb-10">Love Around The World</h2>
            <div id="map" class="rounded-2xl shadow-2xl border-4 border-white"></div>
        </section>

        <!-- Profile Viewer Modal (Dynamic) -->
        <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-80 z-[60] hidden overflow-y-auto">
            <div class="min-h-screen px-4 text-center">
                <span class="inline-block h-screen align-middle" aria-hidden="true">&#8203;</span>
                <div class="inline-block w-full max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl relative">
                    <button onclick="closeProfile()" class="absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl"><i class="fas fa-times"></i></button>
                    
                    <!-- Profile Content -->
                    <div id="profileData" class="text-center">
                        <div class="relative w-40 h-40 mx-auto mb-6">
                            <img id="p_image" src="https://via.placeholder.com/150" class="w-full h-full object-cover heart-mask border-4 border-rose-500 shadow-lg">
                        </div>
                        <h2 id="p_names" class="text-4xl font-bold text-gray-800 mb-2">Names Loading...</h2>
                        <p id="p_date" class="text-sm text-gray-500 mb-4">Established 2023</p>
                        <div id="p_badge" class="inline-block px-4 py-1 rounded-full text-sm font-bold uppercase tracking-wide mb-6 gold-badge">Status</div>
                        <p id="p_slogan" class="text-xl italic font-serif text-rose-600 mb-8">"Slogan goes here"</p>
                        
                        <!-- Tabs for Profile -->
                        <div class="border-t border-gray-200 pt-8">
                            <h3 class="text-2xl font-bold mb-4">Our Memories</h3>
                            <div id="p_posts" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                                <!-- Posts injected here -->
                            </div>
                        </div>

                         <!-- Ad Modal Trigger (Scroll logic handled in JS) -->
                         <div id="adSpace" class="mt-10 p-4 bg-gray-100 hidden">
                             <h4 class="text-xs font-bold text-gray-400 uppercase">Sponsored</h4>
                             <div id="adContent"></div>
                         </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBUjzMFao9BS3uXBOW3qYrLVqHaGn8qIk4",
            authDomain: "onlineshop-30cd1.firebaseapp.com",
            databaseURL: "https://onlineshop-30cd1-default-rtdb.firebaseio.com",
            projectId: "onlineshop-30cd1",
            storageBucket: "onlineshop-30cd1.firebasestorage.app",
            messagingSenderId: "818252574868",
            appId: "1:818252574868:web:8dd36825db589a886cc481",
            measurementId: "G-6YLGGH2NDD"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Map Init
        var map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);

        // Load Couples to Map
        async function loadMap() {
            const dbRef = ref(db);
            get(child(dbRef, `public_profiles`)).then((snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        if(data.lat && data.lng) {
                            var icon = L.divIcon({
                                className: 'custom-div-icon',
                                html: `<div style="background-color:#e11d48;width:10px;height:10px;border-radius:50%;box-shadow:0 0 10px #e11d48;"></div>`,
                                iconSize: [10, 10],
                                iconAnchor: [5, 5]
                            });
                            
                            const marker = L.marker([data.lat, data.lng], {icon: icon}).addTo(map);
                            marker.bindPopup(`
                                <div class="text-center p-2">
                                    <h3 class="font-bold text-rose-600">${data.names}</h3>
                                    <p class="text-xs">${data.city || 'Love City'}</p>
                                    <button onclick="window.location.href='index.html?code=${data.code}'" class="mt-2 text-xs bg-gray-800 text-white px-2 py-1 rounded">View Profile</button>
                                </div>
                            `);
                        }
                    });
                }
            });
        }
        loadMap();

        // Search & Profile View Logic
        window.searchCouple = function() {
            const code = document.getElementById('searchInput').value;
            if(code) window.location.href = `index.html?code=${code}`;
        }

        // Check URL for code
        const urlParams = new URLSearchParams(window.location.search);
        const profileCode = urlParams.get('code');

        if(profileCode) {
            loadProfile(profileCode);
        }

        async function loadProfile(code) {
            const dbRef = ref(db);
            // In a real app we would query by child, for now assuming key is code or search works
            // This is a simplified search for prototype
            get(child(dbRef, `public_profiles`)).then((snapshot) => {
                let found = false;
                snapshot.forEach(child => {
                    const data = child.val();
                    if(data.code === code) {
                        found = true;
                        openProfileModal(data, child.key); // child.key is coupleId
                    }
                });
                if(!found) alert('Couple not found!');
            });
        }

        function openProfileModal(data, coupleId) {
            document.getElementById('profileModal').classList.remove('hidden');
            document.getElementById('p_names').innerText = data.names;
            document.getElementById('p_slogan').innerText = `"${data.slogan || 'Love is eternal'}"`;
            document.getElementById('p_badge').innerText = data.badge || 'Couple';
            document.getElementById('p_date').innerText = 'Established ' + (data.since || 'Recently');
            if(data.photo) document.getElementById('p_image').src = data.photo;

            // Load Posts
            const postsDiv = document.getElementById('p_posts');
            postsDiv.innerHTML = '<p class="text-gray-400 text-sm col-span-2 text-center">Loading memories...</p>';
            
            get(child(ref(db), `couples/${coupleId}/wall`)).then((snap) => {
                postsDiv.innerHTML = '';
                if(snap.exists()) {
                    snap.forEach(postSnap => {
                        const post = postSnap.val();
                        if(post.status === 'published') {
                            postsDiv.innerHTML += `
                                <div class="bg-gray-50 rounded-lg p-4 shadow-sm border border-gray-100">
                                    <img src="${post.image || 'https://via.placeholder.com/300'}" class="w-full h-48 object-cover rounded mb-3">
                                    <p class="text-gray-700 text-sm">${post.text}</p>
                                    <div class="mt-2 flex justify-between text-xs text-gray-400">
                                        <span><i class="fas fa-heart text-rose-500"></i> ${post.likes || 0}</span>
                                        <span>${new Date(post.date).toLocaleDateString()}</span>
                                    </div>
                                </div>
                            `;
                        }
                    });
                } else {
                    postsDiv.innerHTML = '<p class="text-gray-400 col-span-2 text-center">No public memories yet.</p>';
                }
            });

            // Ads Logic (Scroll)
            const modalContainer = document.querySelector('#profileModal > div');
            modalContainer.addEventListener('scroll', () => {
                if(modalContainer.scrollTop > 200) {
                     // Check if ads exist for this couple
                     if(data.adContent && document.getElementById('adSpace').classList.contains('hidden')) {
                         document.getElementById('adSpace').classList.remove('hidden');
                         document.getElementById('adContent').innerHTML = data.adContent;
                     }
                }
            });
        }

        window.closeProfile = function() {
            document.getElementById('profileModal').classList.add('hidden');
            // Remove code from URL without refresh
            window.history.pushState({}, document.title, window.location.pathname);
        }
    </script>
</body>
</html>
